# 数据获取问题修复说明

## 问题描述
在使用 Streamlit 仪表板时,如果选择的日期范围过长(超过 365 天),加密货币数据获取会失败。

## 原因
CoinGecko 免费 API 对历史数据有限制:
- 最多只能获取 365 天的历史数据
- 超过这个限制会返回空数据

## 已修复
✅ 系统已自动修复此问题:

1. **自动限制天数**: 如果选择超过 365 天,系统会自动限制为 365 天
2. **默认时间范围**: 默认改为 90 天,避免 API 限制
3. **友好提示**: 当选择过长时间时会显示警告

## 使用建议

### 推荐的时间范围:

**加密货币数据:**
- 短期分析: 7-30 天
- 中期分析: 30-90 天 (推荐)
- 长期分析: 90-365 天 (最大值)

**股票数据:**
- 短期分析: 30-90 天
- 中期分析: 90-365 天
- 长期分析: 1-5 年

## 如何使用

### 方法 1: 使用默认设置 (推荐)
1. 打开 http://localhost:8501
2. 直接使用默认的 90 天时间范围
3. 选择资产查看数据

### 方法 2: 自定义时间范围
1. 在左侧边栏找到 "Date Range" (日期范围)
2. 设置开始日期和结束日期
3. **注意**: 加密货币最多 365 天

### 方法 3: 使用预设时间范围
在某些页面有快速选择选项:
- 1 周
- 1 个月
- 3 个月
- 6 个月
- 1 年

## 测试示例

### 测试加密货币数据 (30 天)
```python
from data_service.fetchers.live_data import LiveDataFetcher

fetcher = LiveDataFetcher()
data = fetcher.get_crypto_history('bitcoin', days=30)
print(f"获取到 {len(data)} 条数据")
```

### 测试加密货币数据 (365 天)
```python
data = fetcher.get_crypto_history('bitcoin', days=365)
print(f"获取到 {len(data)} 条数据")
```

### 测试股票数据 (任意天数)
```python
# 股票数据没有天数限制
data = fetcher.get_stock_data('AAPL', period='5y')  # 5 年数据
print(f"获取到 {len(data)} 条数据")
```

## API 限制对比

| 数据源 | 免费限制 | 推荐范围 |
|--------|----------|----------|
| CoinGecko (加密货币) | 365 天 | 30-90 天 |
| Yahoo Finance (股票) | 无限制 | 任意 |

## 常见问题

### Q: 为什么加密货币只能获取 365 天?
A: CoinGecko 免费 API 的限制。如需更多历史数据,需要升级到付费版本。

### Q: 股票数据有限制吗?
A: 没有!Yahoo Finance 可以获取多年的历史数据。

### Q: 如何获取更长时间的加密货币数据?
A:
1. 使用 CoinGecko Pro API (付费)
2. 或者分段获取数据并合并
3. 或者使用其他数据源 (如 Binance)

### Q: 系统会自动处理超出限制的情况吗?
A: 是的!系统会自动将超过 365 天的请求限制为 365 天,并显示警告。

## 现在可以正常使用了!

**打开浏览器访问:** http://localhost:8501

**建议:**
- 首次使用时保持默认的 90 天设置
- 加密货币数据不要超过 365 天
- 股票数据可以使用任意时间范围

---

修复时间: 2026-02-12
状态: ✅ 已修复并测试通过
